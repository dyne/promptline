{"id":"batchat-278","title":"Add config env override and missing-key tests","description":"Add unit tests to internal/config for env precedence and validation. Cover: OPENAI_API_KEY/DASHSCOPE_API_KEY override file values; missing API key returns an error; provider defaults (model/base_url) are set when omitted. Update LoadConfig to fail fast on missing key if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T13:03:05.054461925+01:00","updated_at":"2025-12-10T13:10:46.241992798+01:00","closed_at":"2025-12-10T13:10:46.241992798+01:00"}
{"id":"batchat-2ey","title":"Enhance CLI input handling to support command history and proper EOF handling","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T14:27:55.456726657+01:00","updated_at":"2025-12-09T14:35:41.004016332+01:00","closed_at":"2025-12-09T14:35:41.004016332+01:00"}
{"id":"batchat-2qt","title":"Command history not reloaded on startup","description":"Starting the TUI shows empty history navigation even when .promptline_history exists from prior runs; Ctrl+↑/↓ can’t recall past commands. History loader uses a fixed relative path and populates only an in-memory slice (cmd/promptline/main.go:86-195) instead of the readline history file/path used by session.RL. Align history loading/saving with the actual history file location and ensure prior commands are available immediately at boot.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-10T15:30:45.249886992+01:00","updated_at":"2025-12-10T15:30:45.249886992+01:00"}
{"id":"batchat-3im","title":"Lock down tool execution and require user approval","description":"Tool registry currently exposes execute_shell_command/read_file/write_file plus an unconditional 'MUST use tools' system prompt, so model output can run arbitrary shell/file ops without user consent (internal/tools/tools.go:65-86, internal/tools/builtin.go:14-105, internal/chat/session.go:54-74). Add a permission layer or explicit allowlist with per-tool confirmation toggles, disable dangerous tools by default, and surface consent prompts in the UI before executing anything. Default allowlist should only include read-only tools (e.g., get_current_datetime, read_file, ls) with all execution/writes blocked unless explicitly enabled. Update the system prompt to match the new contract, add tests for blocked/allowed execution, and document the safety switches. Follow-up after tool-calling refactor: ensure the consent UI/docs reflect the new structured tool-call flow.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T11:57:47.797323878+01:00","updated_at":"2025-12-10T14:17:33.358237066+01:00","closed_at":"2025-12-10T14:17:33.358237066+01:00"}
{"id":"batchat-3vx","title":"Ctrl+Q quit modal freezes the TUI","description":"Pressing Ctrl+Q shows the quit modal but the UI becomes unresponsive: keypresses don’t dismiss the modal or return to chat, leaving the TUI frozen until force-quit. The quit prompt is built in showModalPromptAsync and invoked from input capture (cmd/promptline/main.go:291-699); focus never moves to the modal and app.Stop isn’t reachable. Fix the quit confirmation so Ctrl+Q cleanly shows a responsive modal and returns focus when cancelled.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T15:30:11.251737886+01:00","updated_at":"2025-12-10T16:26:45.811707695+01:00","closed_at":"2025-12-10T16:26:45.811707695+01:00"}
{"id":"batchat-4vi","title":"Rebrand project to promptline","description":"Rebrand batchat to promptline across code, module name, binary, docs, config, and UI strings; update README to highlight dyne.org origin, Go TUI, OpenAI-compatible; ensure build/test/CI keep working under new name.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T13:21:35.223979842+01:00","updated_at":"2025-12-10T13:31:42.54361846+01:00","closed_at":"2025-12-10T13:31:42.54361846+01:00"}
{"id":"batchat-5gn","title":"Update Makefile build targets for new TUI implementation","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T15:31:29.267828737+01:00","updated_at":"2025-12-09T15:37:41.995898392+01:00","closed_at":"2025-12-09T15:37:41.995898392+01:00","dependencies":[{"issue_id":"batchat-5gn","depends_on_id":"batchat-g30","type":"blocks","created_at":"2025-12-09T15:32:01.382307343+01:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"batchat-5gn","author":"jrml","text":"Update the Makefile to correctly build the application with the new TUI implementation. The build path needs to be updated to reflect the new main.go location in cmd/batchat/.","created_at":"2025-12-09T14:31:35Z"}]}
{"id":"batchat-5yg","title":"Tool call arguments dropped (ls path ignored)","description":"Asking the model to run ls with a specific path (e.g., '..') produces a tool call with empty arguments ({}), so the tool executes in the default directory instead of the requested path. This suggests the streamed tool_call arguments are being lost/overwritten before execution (cmd/promptline/main.go:596-657 tool execution, internal/chat/session.go stream accumulation/finalization). Investigate accumulation/formatting of tool_call arguments in streaming mode and ensure the exact JSON arguments from the provider are preserved through permission display and execution.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T15:54:49.709336727+01:00","updated_at":"2025-12-10T15:57:29.604801663+01:00","closed_at":"2025-12-10T15:57:29.604801663+01:00"}
{"id":"batchat-89r","title":"Permissions panel layout and toggles don’t meet requirements","description":"The /permissions view uses a plain table overlay that doesn’t meet the desired UX: it doesn’t consistently take at least half the right side of the screen, switches are rendered as static ON/OFF text instead of obvious toggles, and layout is horizontal/flat rather than a tall, polished vertical panel (see cmd/promptline/main.go:306-423). Build a tview-based panel that docks on the right at \u003e=50% width, stacks vertically with clear headers/footers, and uses a visible toggle control (checkbox/switch-like) that can be flipped on/off per tool.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T15:30:32.566355264+01:00","updated_at":"2025-12-10T15:30:32.566355264+01:00"}
{"id":"batchat-8wa","title":"Honor API key env vars and validate config","description":"Config loader ignores OPENAI_API_KEY/DASHSCOPE_API_KEY even though docs promise env override; missing keys silently build an empty client (internal/config/config.go:28-54, README.md:34-64). Add env lookup with precedence over config file, fail fast when no key is provided, and handle provider-specific defaults for base_url/model. Update README/config.json.example and add unit tests covering env override and missing-key errors.","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-10T11:58:02.005587078+01:00","updated_at":"2025-12-10T11:58:02.005587078+01:00"}
{"id":"batchat-9bp","title":"Adopt TOON formatting for tool call results","description":"Use TOON (https://github.com/alpkeskin/gotoon) to format tool call results instead of plain text/JSON. Integrate gotoon where tool results are assembled (internal/chat/session.go AddToolResultMessage, cmd/batchat/main.go tool execution display, internal/tools/tools.go result formatting). Add a concise system-prompt snippet per https://toonformat.dev/guide/llm-prompts telling the LLM to expect/respond with TOON for tool outputs. Include tests covering TOON-formatted success/error payloads and ensure tool-call flows remain provider-compliant.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2025-12-10T12:42:08.012155465+01:00","updated_at":"2025-12-10T12:43:34.110991233+01:00"}
{"id":"batchat-b7g","title":"Replace ad-hoc tool markers with OpenAI tool/function-calling","description":"Tool handling relies on custom ✿FUNCTION✿ parsing and mutates user text, storing tool results as user messages instead of tool/function roles (cmd/batchat/main.go:285-352, internal/chat/session.go:321-346, internal/tools/tools.go:90-147). Adopt go-openai tool/function-calling so structured tool calls round-trip correctly, make Session.Messages thread-safe (mutex or channel ownership), and handle streaming tool output without losing prefix text. Add tests for multi-turn tool calls, history updates, and error surfaces.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T11:58:31.172468727+01:00","updated_at":"2025-12-10T12:16:32.731250087+01:00","closed_at":"2025-12-10T12:16:32.731250087+01:00"}
{"id":"batchat-bzi","title":"Fix tool-call response payloads and name handling","description":"Tool-calling flow returns tool role messages with raw text listings, which causes providers to reject with 400 invalid JSON for function.arguments/content; also saw empty tool names leading to 'unknown tool' execution (cmd/promptline/main.go tool handling; internal/chat/session.go AddToolResultMessage/stream accumulator). Ensure streamed tool calls always carry the function name and that tool result messages are JSON-encoded per function-calling contract (e.g., {\"result\": ...} or {\"error\": ...}). Add tests covering tool-call accumulation and JSON content formatting.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T12:20:45.174711563+01:00","updated_at":"2025-12-10T15:42:27.059993715+01:00","closed_at":"2025-12-10T15:42:27.059993715+01:00"}
{"id":"batchat-g30","title":"Implement TUI using tview for better user experience","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-09T15:29:59.864871865+01:00","updated_at":"2025-12-09T15:37:41.994679472+01:00","closed_at":"2025-12-09T15:37:41.994679472+01:00","comments":[{"id":1,"issue_id":"batchat-g30","author":"jrml","text":"Replace the current readline-based CLI interface with a terminal UI using the tview library. This will provide a more user-friendly interface with better visual organization of the chat history and input controls.","created_at":"2025-12-09T14:31:04Z"}]}
{"id":"batchat-k9o","title":"Update README.md to document TUI features","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T15:31:11.459289267+01:00","updated_at":"2025-12-09T15:37:41.997267505+01:00","closed_at":"2025-12-09T15:37:41.997267505+01:00","dependencies":[{"issue_id":"batchat-k9o","depends_on_id":"batchat-g30","type":"blocks","created_at":"2025-12-09T15:31:55.822232345+01:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"batchat-k9o","author":"jrml","text":"Document the new TUI features including keyboard shortcuts (Ctrl+C to exit, Ctrl+G to generate code) and special commands (quit, exit, clear, history).","created_at":"2025-12-09T14:31:17Z"}]}
{"id":"batchat-ko9","title":"Refactor TUI into a testable UI/state package with clean teardown","description":"runTUIMode is ~500 lines mixing view construction, state, and goroutines that never stop (cmd/promptline/main.go:87-500). Extract a UI package/struct that owns the app, views, command registry, and history; give background goroutines (progress animation, elastic height) a context-driven shutdown tied to app.Stop; and centralize event handling/state updates so they can be unit/integration tested. Add tests for history navigation, input resizing, and processing cancellation to ensure lifecycle correctness.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T11:58:16.500824681+01:00","updated_at":"2025-12-10T16:22:17.956223866+01:00","closed_at":"2025-12-10T16:22:17.956223866+01:00"}
{"id":"batchat-ksm","title":"Evaluate migration to OpenAI Responses API","description":"Plan and track migrating from legacy Chat Completions to the new OpenAI Responses API (https://platform.openai.com/docs/guides/migrate-to-responses). Audit current prompt/tool-streaming paths, permissions, and TOON formatting; outline required client changes, request/response shape adjustments, and compatibility concerns. Propose a phased migration plan and identify any blockers or needed refactors in cmd/promptline/main.go and internal/chat/session.go.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T16:05:31.346150991+01:00","updated_at":"2025-12-10T16:05:31.346150991+01:00"}
{"id":"batchat-lfe","title":"Enable mouse scrolling in TextView","description":"Add mouse scrolling support for chat TextView by enabling app.EnableMouse(true) and ensuring TextView mouse handler/ScrollTo are wired. Verify wheel/keyboard scrolling both work when mouse is on, update any setup defaults/docs, and test to confirm mouse wheel navigates chat content.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T16:12:08.380616447+01:00","updated_at":"2025-12-10T16:12:16.647905192+01:00"}
{"id":"batchat-mui","title":"Prune legacy openbatch artifacts after promptline rebrand","description":"Remove or rewrite remnants of the old batch/openbatch workflow (e.g., example_batch_script.py, docs/openbatch.txt) so docs and samples match the promptline TUI chat focus.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-10T13:32:05.200533972+01:00","updated_at":"2025-12-10T13:32:05.200533972+01:00"}
{"id":"batchat-pf9","title":"Permissions modal freezes during tool confirmation","description":"Permission prompts (/permissions modal shown for tool calls) occasionally freeze the TUI: the modal appears but won’t accept input, leaving the app stuck until force-quit. Reproduce by running a tool call that requires confirmation; the modal grabs focus but buttons/keys don’t dismiss. Ensure permission dialogs always stay responsive (focus, ESC/cancel path), clean up pages/focus after close, and add regression coverage if possible.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-12-10T16:29:25.061494716+01:00","updated_at":"2025-12-10T16:40:12.923143361+01:00","dependencies":[{"issue_id":"batchat-pf9","depends_on_id":"batchat-3vx","type":"discovered-from","created_at":"2025-12-10T16:29:25.067458535+01:00","created_by":"jrml"}]}
{"id":"batchat-pfi","title":"Add readline library dependency for enhanced CLI input handling","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T14:29:11.221094923+01:00","updated_at":"2025-12-09T14:34:11.297333661+01:00","closed_at":"2025-12-09T14:34:11.297333661+01:00","dependencies":[{"issue_id":"batchat-pfi","depends_on_id":"batchat-2ey","type":"discovered-from","created_at":"2025-12-09T14:29:11.221924027+01:00","created_by":"daemon"}]}
{"id":"batchat-ttl","title":"Add chat streaming/tool-call coverage","description":"Add unit tests in internal/chat for streaming/tool-call flow: chunked tool_call deltas merge into final calls with arguments and fallback name; tool errors still emit tool messages; TOON formatting includes result and error fields. Mock tool execution to force success and error paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T13:03:34.092020622+01:00","updated_at":"2025-12-10T13:05:31.788248629+01:00","closed_at":"2025-12-10T13:05:31.788248629+01:00"}
{"id":"batchat-ued","title":"Add command handlers unit tests","description":"Add tests for internal/commands: /help uses existing registry (no hardcoded list), /clear preserves only the system message, /history renders tool messages as 'Tool', /debug toggles flag and shows system prompt. Exercise handlers with fake chat session/messages and ensure no panics.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T13:03:19.844856861+01:00","updated_at":"2025-12-10T13:03:19.844856861+01:00"}
{"id":"batchat-ukh","title":"Fix command registry help output and drop /generate stub","description":"The /help handler rebuilds a brand-new registry and hardcodes the command list, so any future commands/extensions are invisible; /generate is a stub we want removed, and commands lack tests (internal/commands/commands.go:126-151, 131-139). Reuse the existing registry for help output, inject dependencies into command handlers, and drop /generate until we intentionally add it later. Add unit tests for help/history/clear behavior and run gofmt over internal/tools/tools_test.go to keep tests readable.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-10T11:58:45.773229018+01:00","updated_at":"2025-12-10T12:01:51.506817082+01:00"}
